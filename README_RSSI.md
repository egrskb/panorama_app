# ПАНОРАМА RSSI - Система трилатерации по RSSI в реальном времени

## Описание

ПАНОРАМА RSSI - это система для поиска радиосигналов в реальном времени с трилатерацией по RSSI (Received Signal Strength Indication). Система использует архитектуру Master-Slave для координации множественных SDR станций и вычисления координат источников радиосигналов.

## Архитектура системы

### 1. Master (HackRF + Sweep)
- **Назначение**: Быстрый обзор диапазона частот и детекция пиков
- **Технология**: HackRF с sweep режимом
- **Функции**:
  - Сканирование заданного диапазона частот
  - Детекция пиков сигналов с подавлением боковых лепестков
  - Формирование watchlist активных сигналов
  - Экспорт данных в формате SweepTile

### 2. Slave SDR (Множественные SDR)
- **Назначение**: Прицельные измерения RSSI в заданных полосах частот
- **Технология**: SoapySDR (поддержка различных SDR устройств)
- **Функции**:
  - Синхронные измерения мощности в заданных полосах
  - Вычисление SNR и уровня шума
  - Калибровка по коэффициенту K_cal_db
  - Проверка на клиппинг и валидность

### 3. Оркестратор
- **Назначение**: Координация всех компонентов системы
- **Функции**:
  - Управление задачами измерений
  - Синхронизация Master и Slave операций
  - Валидация RSSI измерений
  - Запуск трилатерации при наличии ≥3 станций

### 4. Движок трилатерации
- **Назначение**: Вычисление координат источников по RSSI
- **Алгоритм**: Levenberg-Marquardt с весами по SNR
- **Модель**: Логарифмическая модель затухания сигнала
- **Выход**: Координаты (x, y), ковариация, уровень доверия

### 5. Менеджер калибровки
- **Назначение**: Управление калибровочными параметрами
- **Функции**:
  - Профили калибровки для разных конфигураций
  - Позиции SDR станций
  - Калибровочные коэффициенты
  - Параметры модели распространения

## Режимы работы

### Автоматический режим
1. Master sweep сканирует диапазон
2. Детектор пиков находит активные сигналы
3. Оркестратор создает задачи измерений
4. Slave SDR синхронно измеряют RSSI
5. При наличии ≥3 измерений запускается трилатерация
6. Результаты отображаются на карте

### Ручной режим
1. Пользователь задает частоту и полосу
2. Оркестратор создает задачу измерения
3. Slave SDR измеряют RSSI
4. Выполняется трилатерация
5. Результаты обновляются в реальном времени

## Установка и запуск

### Требования
- Python 3.8+
- PyQt5
- NumPy
- SciPy
- SoapySDR
- HackRF (для Master режима)

### Установка зависимостей
```bash
pip install -r requirements.txt
```

### Запуск приложения
```bash
python run_rssi_panorama.py
```

## Конфигурация

### Калибровка станций
Система использует JSON файлы для хранения калибровочных параметров:

```json
{
  "name": "default",
  "description": "Default calibration profile",
  "path_loss_exponent": 2.7,
  "reference_distance": 1.0,
  "reference_power": -30.0,
  "stations": {
    "slave01": {
      "station_id": "slave01",
      "k_cal_db": -33.2,
      "pos_x": 0.0,
      "pos_y": 0.0,
      "pos_z": 0.0,
      "description": "Default Slave 1",
      "last_calibrated": "2024-01-01",
      "temperature": 25.0
    }
  }
}
```

### Параметры измерений
- **Span**: Ширина полосы измерения (по умолчанию 2 МГц)
- **Dwell**: Время измерения (по умолчанию 150 мс)
- **Bin**: Разрешение sweep (по умолчанию 200 кГц)
- **SNR threshold**: Минимальный SNR для валидности (по умолчанию 3 дБ)

## API и события

### События Master
```python
{
  "evt": "peak",
  "f_peak": 5.600e9,
  "snr_db": 22.5,
  "bin_hz": 200000,
  "t0": 1690000000.123
}
```

### Команды Slave
```python
{
  "cmd": "measure_band",
  "epoch": 1690000001.000,
  "windows": [
    {
      "center": 5.600e9,
      "span": 2.0e6,
      "dwell_ms": 150
    }
  ],
  "k_cal_db": {
    "slave01": -33.2,
    "slave02": -31.8,
    "slave03": -34.5
  }
}
```

### Результаты RSSI
```python
{
  "evt": "band_rssi",
  "slave_id": "slave01",
  "center": 5.600e9,
  "span": 2.0e6,
  "band_rssi_dbm": -52.1,
  "band_noise_dbm": -66.8,
  "snr_db": 14.7,
  "n_samples": 1200000,
  "ts": 1690000001.162,
  "flags": {
    "clip": false,
    "agc": false
  }
}
```

### Результаты трилатерации
```python
{
  "evt": "target_update",
  "center": 5.600e9,
  "xy": [x_m, y_m],
  "cov": [[σxx, σxy], [σxy, σyy]],
  "confidence": 0.9,
  "age_ms": 120
}
```

## Производительность

### Требования к оборудованию
- **CPU**: Многоядерный процессор для параллельной обработки
- **RAM**: Минимум 4 ГБ, рекомендуется 8+ ГБ
- **USB**: USB 3.0 для HackRF и SDR устройств
- **Сеть**: Для распределенных SDR станций

### Ограничения производительности
- **Обновление RSSI**: ≥5 Гц при span ≤ 5 МГц
- **Задержка измерения**: ≤ dwell + 50 мс
- **Трилатерация**: ≤ 20 мс на окно
- **Количество станций**: До 6 slave SDR

## Устранение неполадок

### Частые проблемы

#### 1. SDR не инициализируется
- Проверьте права доступа к USB
- Убедитесь, что драйверы установлены
- Проверьте URI устройства

#### 2. Низкая точность трилатерации
- Проверьте калибровку станций
- Убедитесь в правильности позиций
- Проверьте качество RSSI измерений

#### 3. Задержки в измерениях
- Уменьшите dwell время
- Проверьте производительность CPU
- Оптимизируйте количество станций

### Логирование
Система ведет подробные логи всех операций:
- Детекция пиков
- RSSI измерения
- Трилатерация
- Ошибки и предупреждения

## Разработка

### Структура проекта
```
panorama/
├── features/
│   ├── master_sweep/     # Master sweep и детекция пиков
│   ├── slave_sdr/        # Slave SDR и RSSI измерения
│   ├── trilateration/    # Движок трилатерации
│   ├── orchestrator/     # Оркестратор системы
│   └── calibration/      # Менеджер калибровки
├── drivers/              # Драйверы SDR устройств
├── shared/               # Общие утилиты
└── main_rssi.py         # Главное приложение
```

### Добавление новых SDR
1. Создайте класс, наследующий от `SlaveSDR`
2. Реализуйте методы `_init_sdr()` и `measure_band_rssi()`
3. Добавьте поддержку в `SlaveManager`

### Расширение алгоритмов трилатерации
1. Создайте новый класс, наследующий от `RSSITrilaterationEngine`
2. Реализуйте метод `calculate_position()`
3. Добавьте в оркестратор

## Лицензия

© 2024 ПАНОРАМА Team. Все права защищены.

## Поддержка

Для получения поддержки и сообщения об ошибках создайте issue в репозитории проекта.
